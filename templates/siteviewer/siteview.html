{% extends "siteviewer/base.html" %}
{% load compress %}

{% block title %} 
{{ site.name }} Paragliding Forecast
{% endblock %}

{% block meta_desc %}
<meta name="description" content="{{ site.shortname }} wind and weather forecast for paragliders" />
{% endblock %}

{% block head %}
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300' rel='stylesheet' type='text/css'>
{% endblock %}

{% block content %}
<div class="row">
    <div class="span2">
    <div class="sidebar">
        <div class="bline">
        <h3>{{ site.shortname }}</h3>
        </div>
        <p>Launch Direction</p>
        <img class="sideimg" src="{% url 'windDir' -1 site.id 100 %}">
        <a href="http://maps.google.com/?q={{ site.lat }},{{ site.lon }}&z=9" 
            target="_blank" ><img class="sideimg"
            src="http://maps.googleapis.com/maps/api/staticmap?center={{ site.lat }},{{ site.lon }}&markers={{ site.lat }},{{ site.lon }}&zoom=9&size=150x150&sensor=false"></a>
        <ul>
          <li><a href="{{site.website}}" target="_blank">{{site.shortname}} Website</a></li>
          <li><a href="{{site.pgearthSite}}" target="_blank">Details on PG Earth</a></li>
        </ul>
    </div>
    </div>

    <div class="span10">
        {% comment %}
        <a rel="popover"
            href=""
            title="What is a Flyability Report?"
            data-content="It's like a weather forecast for paragliding. It shows your hourly chances of a successful takeoff on a scale from 0 to 100. Click on a day to see forecast details."
            >?</a>
        {% endcomment %}

        <div class="alert alert-info">
            National Weather Service forecast for {{ site.shortname }} last updated at {{ fetchTime|date:"f a e" }} on {{ fetchTime|date:"N j" }}
        </div>

        <ul class="nav nav-tabs daynav">
            {% if not days %}
            <div class="alert">No weather data available at this time.</div>
            {% endif %}
            {% for day in days %}
                <li><a href="#{{day.name}}_details" data-toggle="tab" 
                        class="daylink" id="{{day.name}}_tab">
                    <div class="daytab" >
                        <div class="daybarback"></div>
                        <div class="daybarfront" style="height:{{ day.barheight }}px"></div>
                        <div class="daytextwrap">
                            <p>{{ day.name }}</p>
                            <div class="dayperc">
                                {{ day.flyability|floatformat:0 }}%
                            </div>
                        </div>
                    </div>
                </a></li>
            {% endfor %}
        </ul>

        <div class="tab-content daycontent">
            {% for day in days %}
                <div class="tab-pane" id="{{day.name}}_details">
                    <div class="daytop">
                        {{ day.name }}
                    </div>
                    <div id="{{day.name}}_flyability">Loading...</div>
                    {% comment %}
                    <div class="row">
                        <div class="span12" id="{{day.name}}_dir">Loading...</div>
                    </div>
                    {% endcomment %}
                    <div id="{{day.name}}_wind">Loading...</div>
                    {% comment %}
                        Cloud Cover (%)
                        <div id="{{day.name}}_clouds">Loading...</div>
                        Chance of Precipitation
                    {% endcomment %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
{% compress js %}
<script src="{{ STATIC_URL }}jquery.sparkline.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}plotter.js" type="text/javascript"></script>
{% endcompress %}

<script type="text/javascript">
    $(function() {
        $("a[rel=popover]")
            .popover()
            .click(function(e) {
                e.preventDefault();
        });
        var plotter = new Plotter2();
        plotter.setOptions();
        function arrowMaker(dir, size) {
            if (size === undefined) {
                size = 30 
            }
            var unit = 5.0;
            dir = discretize(dir, unit);
            res = 'url({% url 'windDir' 123456 site.id 234567 %})';
            res = res.replace(/123456/, dir);
            res = res.replace(/234567/, size);
            return res;
        }

        var daywidth = $(".daycontent").width();

        {% for day in days %}
            //plotSummary("{{day.name}}_mini", {{day.scores}});
            var times = {{day.times|safe}};
            $("#{{day.name}}_flyability").width(daywidth);
            $("#{{day.name}}_wind").width(daywidth);
            plotter.plotFlyAndPrecip("{{day.name}}_flyability", times, 
                                     {{day.scores}}, {{day.pop}});
            plotter.plotWind("{{day.name}}_wind", times, {{day.wind}}, 
                             {{day.gust}}, {{day.dir}}, arrowMaker);
        {% endfor %}
        $('#{{ days.1.name }}_tab').tab('show');
    });
</script>
{% endblock %}
